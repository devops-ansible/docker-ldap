#!/usr/bin/env bash

if [ ! -z ${1+x} ] && [ "$( echo "${1}" | tr '[:upper:]' '[:lower:]' )" = "test" ]; then
    # for test purposes, we only check against the staging server of
    # LE if the certificate challenge is sucessfull.
    echo 'running staging lego challenge'
    lego --path="${LEGO_PATH}" \
         --email="${LEGO_ACCOUNT_EMAIL}" \
         --domains="${LEGO_CERT_DOMAIN}" \
         --dns="${LEGO_DNS_PROVIDER}" \
         --dns.resolvers="${LEGO_DNS_RESOLVERS}" \
         --accept-tos \
         --server=https://acme-staging-v02.api.letsencrypt.org/directory  \
         run
else
    # when running in prod mode, the productive LE servers are used
    echo 'running productive lego challenge'
    lego --path="${LEGO_PATH}" \
         --email="${LEGO_ACCOUNT_EMAIL}" \
         --domains="${LEGO_CERT_DOMAIN}" \
         --dns="${LEGO_DNS_PROVIDER}" \
         --dns.resolvers="${LEGO_DNS_RESOLVERS}" \
         --accept-tos \
         run
fi
